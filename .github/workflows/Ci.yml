name: Rust Visualizer CI

on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

env:
  CARGO_TERM_COLOR: always

jobs:
  build-and-test:
    name: Build, Test & Lint
    runs-on: self-hosted

    steps:
      # 1. Checkout the repository content
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. Verify the Rust toolchain version
      - name: Ensure Rust toolchain
        run: rustup show

      # 3. Check code formatting (style compliance)
      - name: Check Formatting
        run: cargo fmt -- --check

      # 4. Run Clippy linter to catch common mistakes and improve code quality
      # Fails if any warnings are found (-D warnings)
      - name: Run Clippy (Linting)
        run: cargo clippy -- -D warnings

      # 5. Run unit and integration tests
      - name: Run tests
        run: cargo test --verbose

      # 6. Build the project in release mode for optimized performance
      - name: Build Release
        run: cargo build --release --verbose

      # 7. Upload the compiled binary as an artifact for download
      - name: Upload Binary Artifact
        uses: actions/upload-artifact@v4
        with:
          name: rust-visualizer-linux
          path: target/release/Rust_visualizer